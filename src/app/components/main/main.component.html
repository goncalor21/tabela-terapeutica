<!-- Main container -->
<div class="mainShell">
  
  <!-- Header with Material toolbar -->
  <mat-toolbar class="app-toolbar">
    <div class="toolbar-content">
      <div class="logo-section" (click)="reloadPage()">
        <img class="logo" src="assets/LogoSemTexto.png" alt="Tabela Terapêutica" />
        <span class="app-title">Tabela Terapêutica</span>
      </div>
      
      <div class="toolbar-actions">
        <button mat-icon-button (click)="openDialog()" matTooltip="Ajuda">
          <mat-icon>help_outline</mat-icon>
        </button>
        <a href="/profile" mat-button class="profile-btn" *ngIf="isLoggedIn">
          <mat-icon>account_circle</mat-icon>
          <span>Perfil</span>
        </a>
      </div>
    </div>
  </mat-toolbar>

  <!-- Main content area -->
  <main class="main-content">
    
    <!-- Input section -->
    <section class="input-section">
      <h2>Insira a Prescrição Médica</h2>
      <form (submit)="handleSubmit()" class="prescription-form">
        <mat-form-field appearance="outline" class="full-width">
          <mat-label>Prescrição</mat-label>
          <textarea 
            matInput 
            [(ngModel)]="textareaValue" 
            name="Prescricao" 
            id="pres1"
            placeholder="Cole ou digite a prescrição médica aqui..."
            rows="8"
            cdkTextareaAutosize
            #autosize="cdkTextareaAutosize"
            cdkAutosizeMinRows="8"
            cdkAutosizeMaxRows="15"></textarea>
          <mat-hint>Exemplo: Paracetamol 500mg, 1 comprimido de 8/8h</mat-hint>
        </mat-form-field>
        
        <div class="form-actions">
          <button 
            mat-raised-button 
            color="primary" 
            type="submit"
            [disabled]="isLoading || !textareaValue || textareaValue.trim().length === 0">
            <mat-icon *ngIf="!isLoading">auto_awesome</mat-icon>
            <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
            {{ isLoading ? 'Processando...' : 'Gerar Tabela' }}
          </button>
        </div>
      </form>
    </section>

    <!-- Preview/Output section -->
    <section class="preview-section" *ngIf="dataSource.length > 0" [@fadeInSlide]>
      <div class="section-header">
        <h2>Tabela de Medicação</h2>
        <div class="action-buttons">
          <button 
            mat-icon-button 
            (click)="toggleEditMode()" 
            [color]="isEditMode ? 'primary' : ''"
            matTooltip="{{ isEditMode ? 'Sair do modo edição' : 'Editar tabela' }}">
            <mat-icon>{{ isEditMode ? 'done' : 'edit' }}</mat-icon>
          </button>
          <button 
            mat-icon-button 
            (click)="printTable()"
            matTooltip="Imprimir tabela">
            <mat-icon>print</mat-icon>
          </button>
          <button 
            mat-icon-button 
            (click)="saveTableClicked()" 
            *ngIf="isLoggedIn"
            matTooltip="Guardar tabela">
            <mat-icon>save</mat-icon>
          </button>
        </div>
      </div>

      <div class="table-container">
        <table mat-table [dataSource]="dataSource" class="medication-table" #elRef>
          
          <!-- Comprimido Column -->
          <ng-container matColumnDef="comprimido">
            <th mat-header-cell *matHeaderCellDef>Medicamento</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else comprimidoView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.comprimido" />
                </mat-form-field>
              </ng-container>
              <ng-template #comprimidoView>{{ element.comprimido }}</ng-template>
            </td>
          </ng-container>

          <!-- Jejum Column -->
          <ng-container matColumnDef="jejum">
            <th mat-header-cell *matHeaderCellDef>Jejum</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else jejumView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.jejum" />
                </mat-form-field>
              </ng-container>
              <ng-template #jejumView>{{ element.jejum }}</ng-template>
            </td>
          </ng-container>

          <!-- Pequeno Almoço Column -->
          <ng-container matColumnDef="peqAlmoco">
            <th mat-header-cell *matHeaderCellDef>Pequeno Almoço</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else peqAlmocoView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.peqAlmoco" />
                </mat-form-field>
              </ng-container>
              <ng-template #peqAlmocoView>{{ element.peqAlmoco }}</ng-template>
            </td>
          </ng-container>

          <!-- Almoço Column -->
          <ng-container matColumnDef="almoco">
            <th mat-header-cell *matHeaderCellDef>Almoço</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else almocoView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.almoco" />
                </mat-form-field>
              </ng-container>
              <ng-template #almocoView>{{ element.almoco }}</ng-template>
            </td>
          </ng-container>

          <!-- Lanche Column -->
          <ng-container matColumnDef="lanche">
            <th mat-header-cell *matHeaderCellDef>Lanche</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else lancheView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.lanche" />
                </mat-form-field>
              </ng-container>
              <ng-template #lancheView>{{ element.lanche }}</ng-template>
            </td>
          </ng-container>

          <!-- Jantar Column -->
          <ng-container matColumnDef="jantar">
            <th mat-header-cell *matHeaderCellDef>Jantar</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else jantarView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.jantar" />
                </mat-form-field>
              </ng-container>
              <ng-template #jantarView>{{ element.jantar }}</ng-template>
            </td>
          </ng-container>

          <!-- Deitar Column -->
          <ng-container matColumnDef="deitar">
            <th mat-header-cell *matHeaderCellDef>Deitar</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else deitarView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.deitar" />
                </mat-form-field>
              </ng-container>
              <ng-template #deitarView>{{ element.deitar }}</ng-template>
            </td>
          </ng-container>

          <!-- Notas Column -->
          <ng-container matColumnDef="notas">
            <th mat-header-cell *matHeaderCellDef>Notas</th>
            <td mat-cell *matCellDef="let element">
              <ng-container *ngIf="isEditMode; else notasView">
                <mat-form-field appearance="outline" class="table-input">
                  <input matInput [(ngModel)]="element.notas" />
                </mat-form-field>
              </ng-container>
              <ng-template #notasView>{{ element.notas }}</ng-template>
            </td>
          </ng-container>

          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>
    </section>

  </main>

  <!-- Footer -->
  <footer class="app-footer">
    <div class="footer-content">
      <p>&copy; 2026 Tabela Terapêutica. Ferramenta de apoio médico.</p>
      <div class="footer-links">
        <a href="https://www.facebook.com" target="_blank" mat-icon-button>
          <mat-icon>facebook</mat-icon>
        </a>
        <a href="mailto:support@example.com" mat-icon-button>
          <mat-icon>alternate_email</mat-icon>
        </a>
      </div>
    </div>
  </footer>

</div>
